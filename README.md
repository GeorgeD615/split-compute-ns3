<body>
  <h1>Распределённый инференс с динамическим выбором точки разделения</h1>

  <h2>Описание проекта</h2>
  <p>
    Данный проект реализует прототип системы распределённого инференса нейросети в условиях, приближённых к реальным AIoT-сценариям.
    Основная цель — минимизация энергопотребления периферийного устройства за счёт динамического выбора слоя разделения модели MobileNetV2.
    Выбор слоя осуществляется на основе анализа параметров беспроводного канала, оцененных с помощью симулятора NS-3.
  </p>

  <h2>Используемые инструменты</h2>
  <ul>
    <li><strong>PyTorch</strong> — для реализации и обучения модели MobileNetV2</li>
    <li><strong>NS-3(С++)</strong> — для симуляции сетевого взаимодействия между клиентом и сервером</li>
    <li><strong>Python</strong> — для скриптов анализа, инференса и управления пайплайном</li>
  </ul>

  <h2>Структура проекта</h2>
  <ul>
    <li><code>mobilenet_mnist.pth</code> — обученная модель MobileNetV2 под MNIST</li>
    <li><code>select_split.py</code> — алгоритм динамического выбора слоя разделения</li>
    <li><code>edge.py</code> — инференс на стороне клиента</li>
    <li><code>server.py</code> — инференс на стороне сервера</li>
    <li><code>edge_postprocess.py</code> — постобработка и получение результата на клиенте после обратной передачи</li>
    <li><code>wifi-sim.cc</code> — сценарий NS-3 для передачи данных по Wi-Fi</li>
    <li><code>energy_analyze.py</code> — оценка энергозатрат на различных слоях</li>
    <li><code>channel_metrics.log</code> — лог состояния канала (SNR и др.)</li>
  </ul>

  <h2>Метрики оценки</h2>
  <ul>
    <li><strong>Энергопотребление</strong> — вычисляется суммарная энергия вычислений, доступа к памяти и передачи данных</li>
    <li><strong>Задержка инференса</strong> — замеряется на клиенте и сервере, а также передача по сети</li>
  </ul>

  <h2>Процесс эксперимента</h2>
  <ol>
    <li>Эмуляция канала с помощью NS-3</li>
    <li>Выбор оптимального слоя разделения на основе логов (SNR, пропускная способность и др.)</li>
    <li>Частичный инференс до выбранного слоя на клиенте (<code>edge.py</code>)</li>
    <li>Симуляция передачи выходного тензора с клиента на сервер (<code>wifi-sim</code>)</li>
    <li>Продолжение инференса на сервере (<code>server.py</code>)</li>
    <li>Эмуляция обратной передачи результата с сервера на клиент через NS-3</li>
    <li>Постобработка на клиенте: интерпретация результатов модели и отображение (<code>edge_postprocess.py</code>)</li>
  </ol>

  <h2>Подготовка модели</h2>
  <ul>
    <li>MobileNetV2 адаптирована под MNIST (224x224, 3 канала)</li>
    <li>Модифицирован классификатор под 10 классов</li>
    <li>Модель сохранена в файл <code>mobilenet_mnist.pth</code></li>
  </ul>

  <h2>Выбор слоя разделения</h2>
  <p>
    Скрипт <code>select_split.py</code> выбирает оптимальный слой модели на основе энергозатрат и пропускной способности канала.
    Используются следующие параметры:
  </p>
  <ul>
    <li>FLOPs и обращения к памяти (расчёт через ptflops)</li>
    <li>Оценка энергии на умножения, сложения, чтение из памяти</li>
    <li>Передача тензора текущего слоя (размер, время передачи, энергия)</li>
  </ul>
  <p>
    Выбранный слой сохраняется в <code>selected_split_layer.txt</code>, метрики — в <code>energy_log.csv</code>.
  </p>

  <h2>Сценарий симуляции в NS-3</h2>
  <p>Сценарий <code>wifi-sim.cc</code> реализует TCP-соединение между клиентом и сервером через Wi-Fi с возможностью моделирования флуктуаций сигнала (Nakagami).</p>
  <ul>
    <li><strong>FileSenderApp</strong> — отправка тензора от клиента</li>
    <li><strong>FileReceiverApp</strong> — приём и логирование данных на сервере</li>
    <li><strong>ServerToClientApp</strong> — обратная передача результата с сервера на клиента</li>
    <li>Используется модель канала с параметрами: передающая мощность, расстояние, шум</li>
  </ul>

  <h2>Запуск эксперимента</h2>
  <ol>
    <li>Запуск симуляции в NS-3 для получения параметров канала</li>
    <li>Вызов <code>select_split.py</code> для определения слоя</li>
    <li>Запуск <code>edge.py</code> — инференс до слоя и сохранение тензора</li>
    <li>Запуск <code>wifi-sim</code> — передача тензора на сервер</li>
    <li>Запуск <code>server.py</code> — инференс после слоя</li>
    <li>Передача результата обратно на клиент через NS-3</li>
    <li>Запуск <code>edge_postprocess.py</code> — интерпретация и отображение итогового результата</li>
  </ol>
</body>
